var BigNumber = require('bignumber.js');

module.exports = {
    /**
     *
     * @param {Number} height
     * @return {BigNumber}
     */
    getTotalSupplyByHeight: function (height) {

        var coins;
        if (height == 0) {
            coins = 0;
        } else if (height < 200001) {
            coins = height * 21000;
        } else if (height < 300001) {
            coins = (height - 200000) * 2500 + 200000 * 21000;
        } else if (height < 400001) {
            coins = (height - 300000) * 1250 + 200000 * 21000 + (300001 - 200001) * 2500;
        } else if (height < 500001) {
            coins = (height - 400000) * 625 + 200000 * 21000 + (300001 - 200001) * 2500 + (400001 - 300001) * 1250;
        } else if (height < 600001) {
            coins = (height - 500000) * 312.5 + 200000 * 21000 + (300001 - 200001) * 2500 + (400001 - 300001) * 1250 + (500001 - 400001) * 625;
        } else if (height < 700001) {
            coins = (height - 600000) * 156.25 + 200000 * 21000 + (300001 - 200001) * 2500 + (400001 - 300001) * 1250 + (500001 - 400001) * 625 + (600001 - 500001) * 312.5;
        } else if (height < 800001) {
            coins = (height - 700000) * 78 + 200000 * 21000 + (300001 - 200001) * 2500 + (400001 - 300001) * 1250 + (500001 - 400001) * 625 + (600001 - 500001) * 312.5 + (700001 - 600001) * 156.25;
        } else if (height < 900001) {
            coins = (height - 800000) * 39 + 200000 * 21000 + (300001 - 200001) * 2500 + (400001 - 300001) * 1250 + (500001 - 400001) * 625 + (600001 - 500001) * 312.5 + (700001 - 600001) * 156.25 + (800001 - 700001) * 78;
        } else if (height < 1000001) {
            coins = (height - 900000) * 19.5 + 200000 * 21000 + (300001 - 200001) * 2500 + (400001 - 300001) * 1250 + (500001 - 400001) * 625 + (600001 - 500001) * 312.5 + (700001 - 600001) * 156.25 + (800001 - 700001) * 78 + (900001 - 800001) * 39;
        } else if (height < 3102401) {
            coins = (height - 1000000) * 8 + 200000 * 21000 + (300001 - 200001) * 2500 + (400001 - 300001) * 1250 + (500001 - 400001) * 625 + (600001 - 500001) * 312.5 + (700001 - 600001) * 156.25 + (800001 - 700001) * 78 + (900001 - 800001) * 39 + (1000001 - 900001) * 19.5;
        } else {
            var halvings = Math.floor(height - 3102400 / 2102400);
            if (halvings >= 64) {
                return 0;
            }
            var subsidy = 4
            subsidy = subsidy / Math.pow(2, halvings)
            coins = (height - 3102400) * subsidy + 200000 * 21000 + (300001 - 200001) * 2500 + (400001 - 300001) * 1250 + (500001 - 400001) * 625 + (600001 - 500001) * 312.5 + (700001 - 600001) * 156.25 + (800001 - 700001) * 78 + (900001 - 800001) * 39 + (1000001 - 900001) * 19.5 + (3102401 - 1000001) * 8;
        }

        return (new BigNumber(0)).plus(coins.toString());
    }

};
